<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otevírání polohy</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; padding: 2rem; background-color: #f4f7f6; color: #333; }
        .container { background-color: white; padding: 2rem; border-radius: 12px; max-width: 500px; margin: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { word-wrap: break-word; }
        .button { display: inline-block; background-color: #007aff; color: white !important; padding: 12px 24px; border-radius: 8px; text-decoration: none; margin-top: 1rem; font-weight: bold; transition: background-color 0.2s; word-wrap: break-word; }
        .button:hover { background-color: #0056b3; }
        .web-link { display: block; margin-top: 1rem; color: #555; word-wrap: break-word;}
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">Připravuji odkaz...</h1>
        <p>Váš prohlížeč by se měl zeptat na povolení otevřít mapovou aplikaci.</p>
        <p>Pokud se nic nestane, použijte prosím jeden z odkazů níže.</p>
        <a id="app-link" href="#" class="button">Otevřít v mapové aplikaci</a>
        <a id="web-link" href="#" target="_blank" class="web-link">Nebo otevřít v Google Mapách (Web)</a>
    </div>

    <script>
        // --- Spolehlivá detekce na straně klienta ---
        // Tento skript běží v prohlížeči uživatele a poskytuje mnohem spolehlivější detekci OS.

        function initializeRedirect() {
            // 1. Získání vyhledávacího dotazu z URL
            const params = new URLSearchParams(window.location.search);
            const searchQuery = params.get('q');

            // Elementy na stránce k aktualizaci
            const titleEl = document.getElementById('title');
            const appLinkEl = document.getElementById('app-link');
            const webLinkEl = document.getElementById('web-link');

            // 2. Kontrola, zda vyhledávací dotaz existuje
            if (!searchQuery) {
                titleEl.textContent = "Chyba: Chybí vyhledávací dotaz";
                appLinkEl.style.display = 'none';
                webLinkEl.style.display = 'none';
                document.querySelector('.container p').textContent = 'Zadejte prosím hledaný výraz do URL, např. "?q=Praha"';
                return;
            }

            // 3. Příprava proměnných
            const encodedQuery = encodeURIComponent(searchQuery);
            // Základní ošetření pro bezpečné zobrazení textu na stránce
            const escapedSearchQuery = searchQuery.replace(/</g, "&lt;").replace(/>/g, "&gt;"); 

            // 4. Spolehlivá detekce OS pomocí navigator.platform
            const platform = navigator.platform;
            let mapUrl = '';
            
            if (platform.toUpperCase().indexOf('WIN') !== -1) {
                // Windows
                mapUrl = `bingmaps:?q=${encodedQuery}`;
            } else if (platform.toUpperCase().indexOf('MAC') !== -1 || platform.toUpperCase().indexOf('IPAD') !== -1 || platform.toUpperCase().indexOf('IPHONE') !== -1 || platform.toUpperCase().indexOf('IPOD') !== -1) {
                // Apple zařízení (macOS, iOS)
                mapUrl = `https://maps.apple.com/?q=${encodedQuery}`;
            } else {
                // Výchozí pro Android, Linux a ostatní
                mapUrl = `geo:0,0?q=${encodedQuery}`;
            }

            const webMapUrl = `https://www.google.com/maps/search/?api=1&query=${encodedQuery}`;

            // 5. Aktualizace obsahu stránky
            titleEl.textContent = `Otevírám "${escapedSearchQuery}"...`;
            appLinkEl.href = mapUrl;
            appLinkEl.textContent = `Otevřít "${escapedSearchQuery}" v mapové aplikaci`; // Dynamický text tlačítka
            webLinkEl.href = webMapUrl;
            webLinkEl.textContent = `Nebo otevřít "${escapedSearchQuery}" v Google Mapách (Web)`; // Dynamický text odkazu

            // 6. Pokus o automatické přesměrování
            window.location.href = mapUrl;
        }

        // Spuštění skriptu po načtení stránky
        window.onload = initializeRedirect;
    </script>
</body>
</html>

